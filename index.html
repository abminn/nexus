<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Nexus</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/gn-math/gn-math.github.io@main/favicon.png">

	<!-- CodeMirror Core -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/hint/show-hint.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/dialog/dialog.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/foldgutter.min.css">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>

	<!-- CodeMirror Addons -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closetag.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/xml-fold.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/foldcode.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/foldgutter.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/brace-fold.min.js"></script>

	<!-- Formatting -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-css.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify.min.js"></script>

	<script type="importmap">
		{
      "imports": {
        "react": "https://esm.sh/react@18.3.1",
        "react-dom": "https://esm.sh/react-dom@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
        "framer-motion": "https://esm.sh/framer-motion@11.11.11"
      }
    }
    </script>

	<style>
		@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
		@import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');

		:root {
			--bg-color: #050505;
			--accent-color: #ffffff;
			--accent-rgb: 255, 255, 255;
			--text-color: #888888;
			--glass-border: rgba(255, 255, 255, 0.08);
			--glass-bg: rgba(255, 255, 255, 0.03);
			--card-bg: rgba(255, 255, 255, 0.02);
            --text-bright: #ffffff;
		}

		body.theme-amoled { --bg-color: #000000; --accent-color: #ffffff; --accent-rgb: 255, 255, 255; --text-bright: #ffffff; }
		body.theme-cyber { --bg-color: #020804; --accent-color: #00ff41; --accent-rgb: 0, 255, 65; --text-bright: #00ff41; }
		body.theme-rose { --bg-color: #0a0507; --accent-color: #fb7185; --accent-rgb: 251, 113, 133; --text-bright: #fb7185; }
		body.theme-gold { --bg-color: #080704; --accent-color: #fbbf24; --accent-rgb: 251, 191, 36; --text-bright: #fbbf24; }

		body {
			font-family: 'Space Grotesk', sans-serif;
			background-color: var(--bg-color);
			color: var(--text-color);
			margin: 0;
			overflow-x: hidden;
			transition: background-color 0.8s cubic-bezier(0.19, 1, 0.22, 1);
		}

        /* Reactive White Text Override */
        .text-white { color: var(--text-bright) !important; }

		.living-bg {
			position: fixed;
			top: 0; left: 0; width: 100%; height: 100%;
			z-index: -1; background: var(--bg-color);
			overflow: hidden;
		}

		.blob {
			position: absolute; width: 70vmax; height: 70vmax;
			background: rgba(var(--accent-rgb), 0.04); filter: blur(120px);
			border-radius: 50%; animation: blobFloat 50s infinite alternate ease-in-out;
			pointer-events: none; transition: background 1s ease;
		}

		.blob:nth-child(2) {
			width: 90vmax; height: 90vmax;
			background: rgba(var(--accent-rgb), 0.03);
			animation-duration: 70s; animation-delay: -20s;
		}

		@keyframes blobFloat {
			0% { transform: translate(-25%, -25%) rotate(0deg) scale(1); }
			33% { transform: translate(35%, 15%) rotate(120deg) scale(1.1); }
			66% { transform: translate(-15%, 45%) rotate(240deg) scale(0.9); }
			100% { transform: translate(15%, -15%) rotate(360deg) scale(1); }
		}

		.glass {
			background: var(--glass-bg);
			backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
			border: 1px solid var(--glass-border);
			transition: border-color 0.6s cubic-bezier(0.19, 1, 0.22, 1), background 0.6s cubic-bezier(0.19, 1, 0.22, 1);
		}

		.accent-text { color: var(--accent-color); }
		.accent-bg { background-color: var(--accent-color); }
		.accent-border { border-color: var(--accent-color); }

		.visible-scroll {
			scrollbar-width: thin;
			scrollbar-color: rgba(var(--accent-rgb), 0.2) transparent;
		}
		.visible-scroll::-webkit-scrollbar { height: 6px; }
		.visible-scroll::-webkit-scrollbar-thumb { background: rgba(var(--accent-rgb), 0.2); border-radius: 10px; }

		.section-header {
			border-left: 5px solid var(--accent-color);
			padding-left: 1.5rem; text-transform: uppercase;
			letter-spacing: 0.2em; color: var(--text-bright); font-weight: 800;
		}

		.badge {
			background: var(--accent-color);
			padding: 2px 8px; border-radius: 6px;
			font-size: 8px; font-weight: 900; color: #000;
		}

		.sidebar-trigger { position: fixed; top: 0; left: 0; width: 60px; height: 100vh; z-index: 100; }
		.sidebar {
			position: fixed; top: 0; left: -280px; width: 280px; height: 100vh;
			z-index: 101; transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
			background: rgba(0, 0, 0, 0.92); backdrop-filter: blur(50px);
			border-right: 1px solid rgba(var(--accent-rgb), 0.08);
		}
		.sidebar-trigger:hover+.sidebar, .sidebar:hover { left: 0; }

        /* Top Bar Autohide System */
        .header-trigger { position: fixed; top: 0; left: 0; width: 100%; height: 40px; z-index: 59; }
        .header-bar {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 60;
            transform: translateY(-100%);
            transition: transform 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .header-trigger:hover+.header-bar, .header-bar:hover { transform: translateY(0); }

		.sidebar-item {
			transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
			display: flex; align-items: center; gap: 1rem; padding: 1.1rem 1.6rem; width: 100%; border-radius: 0.8rem;
			font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.85rem; color: #444;
		}
		.sidebar-item:hover { background: rgba(var(--accent-rgb), 0.08); color: var(--text-bright); padding-left: 2.1rem; }
		.sidebar-item.active { background: rgba(var(--accent-rgb), 0.05); border-left: 4px solid var(--accent-color); color: var(--text-bright); }

		.home-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; gap: 2rem; text-align: center; }
		.home-title { font-size: 8.5rem; font-weight: 800; letter-spacing: -0.05em; color: var(--text-bright); line-height: 0.9; margin: 0; filter: drop-shadow(0 0 20px rgba(var(--accent-rgb),0.05)); }
		.home-subtitle { color: #555; font-size: 1.4rem; margin-top: -0.5rem; font-weight: 500; letter-spacing: 0.05em; }

		.search-container { width: 100%; max-width: 600px; margin-top: 1.5rem; perspective: 1500px; }
		.search-bar {
			background: rgba(20, 20, 20, 0.4); border: 1px solid rgba(var(--accent-rgb), 0.1); border-radius: 100px;
			padding: 1.4rem 2.2rem; display: flex; align-items: center; gap: 1.4rem; transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
		}
		.search-bar:focus-within { border-color: rgba(var(--accent-rgb), 0.4); background: rgba(30, 30, 30, 0.6); box-shadow: 0 0 50px rgba(0,0,0,0.4); }
		.search-bar input { background: transparent; border: none; color: var(--text-bright); width: 100%; outline: none; font-size: 1.2rem; }

		.stat-row { display: flex; gap: 3rem; margin-top: 2rem; color: #333; font-size: 0.9rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.15em; }
		.stat-dot { width: 9px; height: 9px; border-radius: 50%; background: #222; transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1); }
		.stat-dot.glow { background: var(--accent-color); box-shadow: 0 0 20px var(--accent-color); }

		.dock-wrapper { position: fixed; bottom: 4rem; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; gap: 2.5rem; z-index: 80; }
		.dock { background: rgba(10, 10, 10, 0.4); backdrop-filter: blur(35px); border: 1px solid rgba(var(--accent-rgb), 0.1); padding: 1.1rem 2.2rem; border-radius: 40px; display: flex; gap: 2.5rem; }
		.dock-btn { position: relative; cursor: pointer; color: #333; transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1); }
		.dock-btn:hover { color: var(--text-bright); transform: scale(1.25); }
		.tooltip {
			position: absolute; bottom: 180%; left: 50%; transform: translateX(-50%) translateY(15px);
			background: var(--text-bright); color: #000; padding: 0.6rem 1.4rem; border-radius: 14px;
			font-size: 0.75rem; font-weight: 900; text-transform: uppercase; white-space: nowrap;
			opacity: 0; visibility: hidden; transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
		}
		.dock-btn:hover .tooltip { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }

		.letter-circle {
			width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;
			background: var(--glass-bg); border: 1px solid var(--glass-border);
			border-radius: 18px; font-size: 1.8rem; font-weight: 900; color: var(--text-bright);
		}

		.vault-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1.8rem; }
		.utility-card { aspect-ratio: 16/9; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2.5rem; text-align: center; }

		.CodeMirror { height: 100% !important; font-family: 'Fira Code', monospace; font-size: 14px; background: #080808 !important; color: var(--text-bright) !important; }
		
		/* QoL Components */
		.themed-btn { background: var(--accent-color); color: #000; font-weight: 900; transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1); }
		.themed-btn:hover { filter: brightness(0.9); transform: translateY(-2px); }
		.themed-btn:active { transform: scale(0.95); }
		.themed-btn-secondary { background: rgba(var(--accent-rgb), 0.08); color: var(--text-bright); border: 1px solid var(--glass-border); }
		.themed-btn-secondary:hover { background: rgba(var(--accent-rgb), 0.15); border-color: rgba(var(--accent-rgb), 0.3); }

		.whoopies-box { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10rem 0; gap: 3rem; }
		.whoopies-guy { width: 160px; height: 160px; fill: rgba(var(--accent-rgb), 0.08); animation: guyBob 4s infinite ease-in-out; }
		@keyframes guyBob { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(6deg); } }

		/* Page Transitions */
		.page-exit-active { pointer-events: none; }

        /* Art Tools specific */
        .art-canvas { cursor: crosshair; touch-action: none; background: #fff; border-radius: 1rem; }
	</style>
</head>

<body>
	<div class="living-bg">
		<div class="blob"></div>
		<div class="blob"></div>
	</div>
	<div id="root"></div>

	<script type="module">
		import React, { useState, useEffect, createElement, useMemo, useRef, Fragment } from 'react';
        import ReactDOM from 'react-dom/client';
        import { motion, useMotionValue, useSpring, useTransform, AnimatePresence } from 'framer-motion';

        const ZONES_URL = "https://cdn.jsdelivr.net/gh/gn-math/assets@main/zones.json";
        const COVER_BASE = "https://cdn.jsdelivr.net/gh/gn-math/covers@main";
        const HTML_BASE = "https://cdn.jsdelivr.net/gh/gn-math/html@main";

        // External Repositories Config
        const ZOTRONIX_API = "https://api.github.com/repos/Zotronix/Ignis-Games/contents/Games";
        const ZOTRONIX_BASE = "https://cdn.jsdelivr.net/gh/Zotronix/Ignis-Games@main/Games/";
        const ZOTRONIX_IMAGES = "https://cdn.jsdelivr.net/gh/Zotronix/Ignis-Games@main/Images/";

        const ABMINN_API = "https://api.github.com/repos/abminn/Nexus-Games/contents/Games";
        const ABMINN_BASE = "https://cdn.jsdelivr.net/gh/abminn/Nexus-Games@main/Games/";
        const ABMINN_IMAGES = "https://cdn.jsdelivr.net/gh/abminn/Nexus-Games@main/Images/";

        const HOT_TITLES = ["Buckshot Roulette", "ULTRAKILL", "Pizza Tower", "R.E.P.O", "People Playground", "Sprunki", "WebFishing", "Blade Ball", "OvO", "1v1.lol", "Tunnel Rush"];
        const FEATURED_TITLES = ["Minecraft 1.21.4", "Geometry Dash Lite", "Retro Bowl", "Friday Night Funkin", "Happy Wheels", "Slope", "Papa's Freezeria", "Cookie Clicker", "Plants vs Zombies", "Retro Bowl College", "Subway Surfers", "Moto X3M"];

        const THEMES = [
            { id: 'dark', name: 'Cosmic Minimal', class: '' },
            { id: 'amoled', name: 'True Black', class: 'theme-amoled' },
            { id: 'cyber', name: 'Cyber Neon', class: 'theme-cyber' },
            { id: 'rose', name: 'Rose Nebula', class: 'theme-rose' },
            { id: 'gold', name: 'Golden Sun', class: 'theme-gold' }
        ];

        // 3D Weighted Smooth Tilt
        const InteractiveTilt = ({ children, className = "", scale = 1.025, rotate = 14 }) => {
            const x = useMotionValue(0);
            const y = useMotionValue(0);

            const mouseXSpring = useSpring(x, { stiffness: 180, damping: 30 });
            const mouseYSpring = useSpring(y, { stiffness: 180, damping: 30 });

            const rotateX = useTransform(mouseYSpring, [-0.5, 0.5], [`${rotate}deg`, `-${rotate}deg`]);
            const rotateY = useTransform(mouseXSpring, [-0.5, 0.5], [`-${rotate}deg`, `${rotate}deg`]);

            const handleMouseMove = (e) => {
                const rect = e.currentTarget.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                x.set((mouseX / rect.width) - 0.5);
                y.set((mouseY / rect.height) - 0.5);
            };

            const handleMouseLeave = () => { x.set(0); y.set(0); };

            return createElement(motion.div, {
                onMouseMove: handleMouseMove,
                onMouseLeave: handleMouseLeave,
                style: { rotateX, rotateY, transformStyle: "preserve-3d" },
                whileHover: { scale },
                className: `${className} relative`
            }, children);
        };

        const HomeIcon = () => createElement('svg', { className: 'w-5 h-5 fill-current', viewBox: '0 0 24 24' }, createElement('path', { d: 'M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z' }));
        const GameIcon = () => createElement('svg', { className: 'w-5 h-5 fill-current', viewBox: '0 0 24 24' }, createElement('path', { d: 'M21,6H3C1.9,6,1,6.9,1,8v8c0,1.1,0.9,2,2,2h18c1.1,0,2-0.9,2-2V8C23,6.9,22.1,6,21,6z M18,15c-0.55,0-1-0.45-1-1s0.45-1,1-1s1,0.45,1,1S18.55,15,18,15z M20,12c-0.55,0-1-0.45-1-1s0.45-1,1-1s1,0.45,1,1S20.55,12,20,12z M11,13H9v2H8v-2H6v-1h2V10h1v2h2V13z' }));
        const AnimeIcon = () => createElement('svg', { className: 'w-5 h-5 fill-current', viewBox: '0 0 24 24' }, createElement('path', { d: 'M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71L12 2z' }));
        const MangaIcon = () => createElement('svg', { className: 'w-5 h-5 fill-current', viewBox: '0 0 24 24' }, createElement('path', { d: 'M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5-1.17 0-2.39.15-3.5.5V19.5c1.11-.35 2.33-.5 3.5-.5 1.95 0-4.05.4 5.5 1.5 1.45-1.1 3.55-1.5 5.5-1.5 1.17 0-2.39.15-3.5.5V5zM12 7.5c1.45-1.1 3.55-1.5 5.5-1.5 1.17 0-2.39.15 3.5.5v11.5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5V7.5z' }));
        const ToolIcon = () => createElement('svg', { className: 'w-5 h-5 fill-current', viewBox: '0 0 24 24' }, createElement('path', { d: 'M22.7,19l-9.1-9.1c0.9-2.3,0.4-5-1.5-6.9c-2-2-5-2.4-7.4-1.3L9,6.5L6.5,9L1.7,4.2c-1.1,2.4-0.7,5.4,1.3,7.4c1.9,1.9,4.5,2.4,6.9,1.5l9.1,9.1c0.4,0.4,1,0.4,1.4,0l2.3-2.3C23.1,19.9,23.1,19.3,22.7,19z' }));
        const ArtIcon = () => createElement('svg', { className: 'w-5 h-5 fill-current', viewBox: '0 0 24 24' }, createElement('path', { d: 'M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z' }));

        const SettingsModal = ({ onClose, currentTheme, onThemeChange, currentCloak, onCloakChange }) => (
            createElement('div', { className: 'fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/85 backdrop-blur-md', onClick: onClose },
                createElement(InteractiveTilt, { scale: 1.01, rotate: 4 },
                    createElement(motion.div, { 
                        initial: { opacity: 0, y: 50, scale: 0.9 }, animate: { opacity: 1, y: 0, scale: 1 }, transition: { type: "spring", stiffness: 200, damping: 25 },
                        className: 'glass w-full max-w-md p-10 rounded-[2.5rem] flex flex-col gap-10', onClick: e => e.stopPropagation() 
                    },
                        createElement('h2', { className: 'text-3xl font-black text-white italic tracking-tighter uppercase' }, 'System Configuration'),
                        createElement('div', { className: 'space-y-4' },
                            createElement('h3', { className: 'text-[11px] font-bold accent-text uppercase tracking-widest' }, 'Cloaking Protocol'),
                            createElement('input', { 
                                type: 'text', value: currentCloak, 
                                onChange: (e) => onCloakChange(e.target.value), 
                                placeholder: 'Tab Title...', 
                                className: 'w-full themed-input rounded-2xl px-6 py-4 text-sm transition-all focus:border-white/30 outline-none' 
                            })
                        ),
                        createElement('div', { className: 'space-y-4' },
                            createElement('h3', { className: 'text-[11px] font-bold accent-text uppercase tracking-widest' }, 'Visual Themes'),
                            createElement('div', { className: 'grid grid-cols-2 gap-3' },
                                THEMES.map(theme => createElement('button', { 
                                    key: theme.id, 
                                    onClick: () => onThemeChange(theme.id), 
                                    className: `p-4 rounded-xl border text-[12px] font-black uppercase transition-all ${currentTheme === theme.id ? 'themed-btn' : 'themed-btn-secondary opacity-50 hover:opacity-100'}` 
                                }, theme.name))
                            )
                        ),
                        createElement('button', { onClick: onClose, className: 'themed-btn w-full py-5 rounded-3xl uppercase text-sm tracking-[0.2em]' }, 'Sync Updates')
                    )
                )
            )
        );

        // Helper to get correct canvas coordinates regardless of scaling
        const getCanvasCoords = (e, canvas) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        };

        // --- ART SECTION: DRAWING ---
        const DrawingTool = () => {
            const canvasRef = useRef(null);
            const [color, setColor] = useState('#000000');
            const [brushSize, setBrushSize] = useState(5);
            const [history, setHistory] = useState([]);
            const [redoStack, setRedoStack] = useState([]);
            const isDrawing = useRef(false);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                // Initialize white background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                saveState();
            }, []);

            const saveState = () => {
                const canvas = canvasRef.current;
                setHistory(prev => [...prev, canvas.toDataURL()]);
                setRedoStack([]);
            };

            const undo = () => {
                if (history.length <= 1) return;
                const newHistory = [...history];
                const last = newHistory.pop();
                setRedoStack(prev => [...prev, last]);
                setHistory(newHistory);
                restoreState(newHistory[newHistory.length - 1]);
            };

            const redo = () => {
                if (redoStack.length === 0) return;
                const newRedo = [...redoStack];
                const next = newRedo.pop();
                setRedoStack(newRedo);
                setHistory(prev => [...prev, next]);
                restoreState(next);
            };

            const restoreState = (dataUrl) => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const img = new Image();
                img.src = dataUrl;
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
            };

            const startDrawing = (e) => {
                isDrawing.current = true;
                const coords = getCanvasCoords(e, canvasRef.current);
                const ctx = canvasRef.current.getContext('2d');
                ctx.beginPath();
                ctx.moveTo(coords.x, coords.y);
                draw(e);
            };

            const endDrawing = () => {
                if (isDrawing.current) {
                    isDrawing.current = false;
                    const ctx = canvasRef.current.getContext('2d');
                    ctx.beginPath();
                    saveState();
                }
            };

            const draw = (e) => {
                if (!isDrawing.current) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const coords = getCanvasCoords(e, canvas);

                ctx.lineWidth = brushSize;
                ctx.strokeStyle = color;
                ctx.lineTo(coords.x, coords.y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(coords.x, coords.y);
            };

            const clearCanvas = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                saveState();
            };

            const exportPNG = () => {
                const link = document.createElement('a');
                link.download = 'nexus-sketch.png';
                link.href = canvasRef.current.toDataURL();
                link.click();
            };

            return createElement('div', { className: 'flex flex-col gap-8' },
                createElement('div', { className: 'flex flex-wrap items-center gap-4 glass p-6 rounded-3xl' },
                    createElement('input', { type: 'color', value: color, onChange: e => setColor(e.target.value), className: 'w-12 h-12 rounded-lg cursor-pointer bg-transparent border-none' }),
                    createElement('div', { className: 'flex flex-col gap-1' },
                        createElement('label', { className: 'text-[10px] font-bold uppercase tracking-widest text-white/40' }, 'Size'),
                        createElement('input', { type: 'range', min: 1, max: 100, value: brushSize, onChange: e => setBrushSize(parseInt(e.target.value)), className: 'w-32 accent-white' })
                    ),
                    createElement('div', { className: 'flex gap-2 ml-auto' },
                        createElement('button', { onClick: undo, className: 'themed-btn-secondary px-6 py-2 rounded-xl text-[10px] font-bold uppercase' }, 'Undo'),
                        createElement('button', { onClick: redo, className: 'themed-btn-secondary px-6 py-2 rounded-xl text-[10px] font-bold uppercase' }, 'Redo'),
                        createElement('button', { onClick: clearCanvas, className: 'themed-btn-secondary px-6 py-2 rounded-xl text-[10px] font-bold uppercase text-red-400' }, 'Clear'),
                        createElement('button', { onClick: exportPNG, className: 'themed-btn px-6 py-2 rounded-xl text-[10px] font-bold uppercase' }, 'Export PNG')
                    )
                ),
                createElement('div', { className: 'flex justify-center' },
                    createElement('canvas', {
                        ref: canvasRef, width: 1200, height: 800,
                        className: 'art-canvas shadow-2xl w-full max-w-4xl h-auto',
                        onMouseDown: startDrawing, onMouseMove: draw, onMouseUp: endDrawing, onMouseOut: endDrawing,
                        onTouchStart: startDrawing, onTouchMove: draw, onTouchEnd: endDrawing
                    })
                )
            );
        };

        // --- ART SECTION: ANIMATING ---
        const AnimatingTool = () => {
            const canvasRef = useRef(null);
            const [frames, setFrames] = useState([null]); // Array of Data URLs
            const [currentFrameIdx, setCurrentFrameIdx] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            const [isExporting, setIsExporting] = useState(false);
            const [fps, setFps] = useState(12);
            const [onionSkin, setOnionSkin] = useState(true);
            const [showFirstFrame, setShowFirstFrame] = useState(false);
            const [brushSize, setBrushSize] = useState(5);
            const [color, setColor] = useState('#000000');
            const isDrawing = useRef(false);
            const playInterval = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                clearFrame();
            }, []);

            // Frame loading logic with sequential layer support
            const loadFrameToCanvas = async (idx) => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                const drawImage = (src, alpha = 1.0) => new Promise((resolve) => {
                    if (!src) return resolve();
                    const img = new Image();
                    img.src = src;
                    img.onload = () => {
                        ctx.globalAlpha = alpha;
                        ctx.drawImage(img, 0, 0);
                        ctx.globalAlpha = 1.0;
                        resolve();
                    };
                    img.onerror = resolve;
                });

                // In playback, only draw current frame for performance/clarity
                if (isPlaying) {
                    await drawImage(frames[idx]);
                } else {
                    // Layer 1: Onion Skin (Prev Frame)
                    if (onionSkin && idx > 0) {
                        await drawImage(frames[idx - 1], 0.15);
                    }
                    // Layer 2: First Frame Ref
                    if (showFirstFrame && idx !== 0) {
                        await drawImage(frames[0], 0.15);
                    }
                    // Layer 3: Current Frame
                    await drawImage(frames[idx], 1.0);
                }
            };

            // Trigger frame load whenever indexing or options change
            useEffect(() => {
                loadFrameToCanvas(currentFrameIdx);
            }, [currentFrameIdx, onionSkin, showFirstFrame, isPlaying]);

            // Playback management
            useEffect(() => {
                if (isPlaying) {
                    playInterval.current = setInterval(() => {
                        setCurrentFrameIdx(prev => (prev + 1) % frames.length);
                    }, 1000 / fps);
                } else {
                    clearInterval(playInterval.current);
                }
                return () => clearInterval(playInterval.current);
            }, [isPlaying, fps, frames.length]);

            const saveCurrentFrame = () => {
                const canvas = canvasRef.current;
                const data = canvas.toDataURL();
                setFrames(prev => {
                    const next = [...prev];
                    next[currentFrameIdx] = data;
                    return next;
                });
            };

            const startDrawing = (e) => {
                if (isPlaying) return;
                isDrawing.current = true;
                const coords = getCanvasCoords(e, canvasRef.current);
                const ctx = canvasRef.current.getContext('2d');
                ctx.beginPath();
                ctx.moveTo(coords.x, coords.y);
                draw(e);
            };

            const endDrawing = () => {
                if (isDrawing.current) {
                    isDrawing.current = false;
                    const ctx = canvasRef.current.getContext('2d');
                    ctx.beginPath();
                    saveCurrentFrame();
                }
            };

            const draw = (e) => {
                if (!isDrawing.current || isPlaying) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const coords = getCanvasCoords(e, canvas);

                ctx.lineWidth = brushSize;
                ctx.strokeStyle = color;
                ctx.lineTo(coords.x, coords.y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(coords.x, coords.y);
            };

            const addFrame = () => {
                setFrames(prev => [...prev.slice(0, currentFrameIdx + 1), null, ...prev.slice(currentFrameIdx + 1)]);
                setCurrentFrameIdx(currentFrameIdx + 1);
            };

            const deleteFrame = () => {
                if (frames.length <= 1) return;
                setFrames(prev => prev.filter((_, i) => i !== currentFrameIdx));
                setCurrentFrameIdx(Math.max(0, currentFrameIdx - 1));
            };

            const duplicateFrame = () => {
                const currentData = frames[currentFrameIdx];
                setFrames(prev => [...prev.slice(0, currentFrameIdx + 1), currentData, ...prev.slice(currentFrameIdx + 1)]);
                setCurrentFrameIdx(currentFrameIdx + 1);
            };

            const clearFrame = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                saveCurrentFrame();
            };

            const exportVideo = async () => {
                if (frames.length < 2) return;
                setIsExporting(true);
                const canvas = canvasRef.current;
                const stream = canvas.captureStream(fps);
                const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
                const chunks = [];
                
                recorder.ondataavailable = (e) => chunks.push(e.data);
                recorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'nexus-animation.webm';
                    a.click();
                    setIsExporting(false);
                };

                // Reset to start
                setIsPlaying(false);
                setCurrentFrameIdx(0);
                
                // Start recording
                recorder.start();
                setIsPlaying(true);

                // Play through once and stop
                setTimeout(() => {
                    setIsPlaying(false);
                    recorder.stop();
                    setCurrentFrameIdx(0);
                }, (1000 / fps) * frames.length + 500);
            };

            return createElement('div', { className: 'flex flex-col gap-6' },
                createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-4 gap-6' },
                    createElement('div', { className: 'lg:col-span-3 flex flex-col gap-6' },
                        createElement('div', { className: 'flex justify-center relative' },
                            createElement('canvas', {
                                ref: canvasRef, width: 800, height: 600,
                                className: 'art-canvas shadow-2xl w-full max-w-2xl h-auto bg-white',
                                onMouseDown: startDrawing, onMouseMove: draw, onMouseUp: endDrawing, onMouseOut: endDrawing,
                                onTouchStart: startDrawing, onTouchMove: draw, onTouchEnd: endDrawing
                            }),
                            isPlaying && createElement('div', { className: 'absolute inset-0 bg-black/10 pointer-events-none rounded-2xl flex items-center justify-center' }, 
                                createElement('div', { className: 'badge !px-4 !py-2 !text-[12px]' }, 'PLAYING')
                            ),
                            isExporting && createElement('div', { className: 'absolute inset-0 bg-black/60 z-[10] flex items-center justify-center rounded-2xl flex-col gap-4' }, 
                                createElement('div', { className: 'w-10 h-10 border-2 border-white/10 border-t-white rounded-full animate-spin' }),
                                createElement('p', { className: 'text-[10px] font-black uppercase tracking-widest text-white' }, 'Capturing Stream...')
                            )
                        ),
                        createElement('div', { className: 'flex flex-wrap items-center gap-4 glass p-6 rounded-3xl' },
                            createElement('button', { onClick: () => setIsPlaying(!isPlaying), className: `px-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all ${isPlaying ? 'bg-red-500 text-white' : 'themed-btn'}` }, isPlaying ? 'Pause' : 'Play Sequence'),
                            createElement('button', { onClick: exportVideo, disabled: isExporting || frames.length < 2, className: `themed-btn-secondary px-8 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all ${isExporting ? 'opacity-30' : ''}` }, 'Export WebM'),
                            createElement('div', { className: 'flex flex-col gap-1' },
                                createElement('label', { className: 'text-[10px] font-bold uppercase tracking-widest text-white/40' }, `FPS: ${fps}`),
                                createElement('input', { type: 'range', min: 1, max: 60, value: fps, onChange: e => setFps(parseInt(e.target.value)), className: 'w-32 accent-white' })
                            ),
                            createElement('div', { className: 'h-8 w-px bg-white/10 mx-2' }),
                            createElement('div', { className: 'flex gap-3 items-center' },
                                createElement('button', { onClick: () => setOnionSkin(!onionSkin), className: `px-6 py-2 rounded-xl text-[9px] font-bold uppercase ${onionSkin ? 'themed-btn' : 'themed-btn-secondary opacity-50'}` }, 'Onion Skin'),
                                createElement('button', { onClick: () => setShowFirstFrame(!showFirstFrame), className: `px-6 py-2 rounded-xl text-[9px] font-bold uppercase ${showFirstFrame ? 'themed-btn' : 'themed-btn-secondary opacity-50'}` }, 'First Frame Ref')
                            )
                        )
                    ),
                    createElement('div', { className: 'flex flex-col gap-6' },
                        createElement('div', { className: 'glass p-6 rounded-[2.5rem] flex flex-col gap-6' },
                            createElement('h3', { className: 'text-[10px] font-black uppercase tracking-[0.3em] text-white/50 border-b border-white/5 pb-4' }, 'Toolbox'),
                            createElement('div', { className: 'flex flex-col gap-4' },
                                createElement('input', { type: 'color', value: color, onChange: e => setColor(e.target.value), className: 'w-full h-12 rounded-xl cursor-pointer bg-transparent border-none' }),
                                createElement('div', { className: 'flex flex-col gap-2' },
                                    createElement('label', { className: 'text-[9px] font-bold uppercase tracking-widest text-white/30' }, 'Brush Size'),
                                    createElement('input', { type: 'range', min: 1, max: 100, value: brushSize, onChange: e => setBrushSize(parseInt(e.target.value)), className: 'w-full accent-white' })
                                ),
                                createElement('button', { onClick: clearFrame, className: 'themed-btn-secondary w-full py-3 rounded-xl text-[10px] font-bold uppercase text-red-400' }, 'Clear Frame')
                            )
                        ),
                        createElement('div', { className: 'glass p-6 rounded-[2.5rem] flex flex-col gap-4' },
                            createElement('div', { className: 'flex justify-between items-center' },
                                createElement('h3', { className: 'text-[10px] font-black uppercase tracking-[0.3em] text-white/50' }, 'Timeline'),
                                createElement('span', { className: 'text-[10px] font-black text-white/30' }, `${currentFrameIdx + 1} / ${frames.length}`)
                            ),
                            createElement('div', { className: 'flex flex-col gap-2 max-h-[300px] overflow-y-auto visible-scroll pr-2' },
                                frames.map((f, i) => createElement('button', { 
                                    key: i, onClick: () => { if (!isPlaying) setCurrentFrameIdx(i); },
                                    className: `w-full p-4 rounded-xl text-[10px] font-bold uppercase transition-all flex justify-between items-center ${currentFrameIdx === i ? 'bg-white/10 border border-white/20 text-white' : 'text-white/30 hover:text-white/60'}`
                                }, 
                                    `Frame ${i + 1}`,
                                    currentFrameIdx === i && createElement('div', { className: 'w-1.5 h-1.5 rounded-full bg-white shadow-[0_0_8px_#fff]' })
                                ))
                            ),
                            createElement('div', { className: 'grid grid-cols-1 gap-2 mt-2' },
                                createElement('button', { onClick: addFrame, className: 'themed-btn w-full py-3 rounded-xl text-[9px] font-black uppercase tracking-widest' }, '+ New Frame'),
                                createElement('div', { className: 'grid grid-cols-2 gap-2' },
                                    createElement('button', { onClick: duplicateFrame, className: 'themed-btn-secondary py-3 rounded-xl text-[9px] font-bold uppercase' }, 'Clone'),
                                    createElement('button', { onClick: deleteFrame, className: 'themed-btn-secondary py-3 rounded-xl text-[9px] font-bold uppercase text-red-500' }, 'Delete')
                                )
                            )
                        )
                    )
                )
            );
        };

        const ArtView = () => {
            const [artMode, setArtMode] = useState('animating'); // 'animating' | 'drawing'

            return createElement(motion.div, { initial: { opacity: 0 }, animate: { opacity: 1 }, className: 'space-y-12' },
                createElement('div', { className: 'flex flex-col md:flex-row justify-between items-center gap-6' },
                    createElement('div', null,
                        createElement('h2', { className: 'text-5xl font-black italic text-white uppercase tracking-tighter' }, 'Creative Suite'),
                        createElement('p', { className: 'text-slate-600 font-medium text-lg mt-2 uppercase tracking-widest' }, 'High-fidelity visual production node.')
                    ),
                    createElement('div', { className: 'flex gap-3 glass p-2 rounded-3xl' },
                        createElement('button', { 
                            onClick: () => setArtMode('animating'), 
                            className: `px-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all ${artMode === 'animating' ? 'themed-btn' : 'themed-btn-secondary opacity-50'}` 
                        }, 'Animating'),
                        createElement('button', { 
                            onClick: () => setArtMode('drawing'), 
                            className: `px-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all ${artMode === 'drawing' ? 'themed-btn' : 'themed-btn-secondary opacity-50'}` 
                        }, 'Drawing')
                    )
                ),
                artMode === 'animating' ? createElement(AnimatingTool) : createElement(DrawingTool)
            );
        };

        const IDE = ({ onDeploy, onClose }) => {
            const editorHostRef = useRef(null);
            const cmInstance = useRef(null);
            const [isModified, setIsModified] = useState(false);

            useEffect(() => {
                if (!editorHostRef.current) return;
                const editor = CodeMirror(editorHostRef.current, {
                    value: "<!-- Nexus Development Workspace -->\n<html>\n  <head>\n    <style>\n      body {\n        background: #000; color: #fff;\n        display: flex; flex-direction: column; align-items: center; justify-content: center;\n        height: 100vh; font-family: 'Space Grotesk', sans-serif;\n      }\n    </style>\n  </head>\n  <body>\n    <h1>Nexus Project Node</h1>\n    <p>Build the stars.</p>\n  </body>\n</html>", 
                    mode: "htmlmixed", theme: "dracula", lineNumbers: true,
                    autoCloseTags: true, autoCloseBrackets: true,
                    foldGutter: true, tabSize: 2, lineWrapping: true
                });
                cmInstance.current = editor;
                editor.on("change", () => setIsModified(true));
                return () => { if (cmInstance.current) { const wrapper = cmInstance.current.getWrapperElement(); if (wrapper && wrapper.parentNode) { wrapper.parentNode.removeChild(wrapper); } } };
            }, []);

            const formatCode = () => {
                if (!cmInstance.current) return;
                const code = cmInstance.current.getValue();
                const formatted = html_beautify(code, { indent_size: 2, space_in_empty_paren: true });
                cmInstance.current.setValue(formatted);
            };

            const downloadCode = () => {
                const blob = new Blob([cmInstance.current.getValue()], { type: "text/html" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url; a.download = "nexus_build.html"; a.click();
                URL.revokeObjectURL(url);
                setIsModified(false);
            };

            return createElement(motion.div, { 
                initial: { opacity: 0, scale: 0.95 }, animate: { opacity: 1, scale: 1 }, transition: { duration: 0.6, ease: [0.19, 1, 0.22, 1] },
                className: 'fixed inset-0 z-[150] bg-black/98 backdrop-blur-3xl flex items-center justify-center p-8' 
            },
                createElement('div', { className: 'glass w-full max-w-[100rem] rounded-[3.5rem] overflow-hidden flex flex-col h-[90vh]' },
                    createElement('div', { className: 'bg-white/5 p-7 border-b border-white/10 flex justify-between items-center' },
                        createElement('div', { className: 'flex items-center gap-5' },
                            createElement('span', { className: 'text-[12px] font-black uppercase tracking-[0.4em] text-slate-500' }, 'nexus_dev_node.html'),
                            isModified && createElement('div', { className: 'w-2.5 h-2.5 rounded-full bg-sky-500 shadow-[0_0_15px_#0ea5e9] animate-pulse' })
                        ),
                        createElement('div', { className: 'flex gap-4' },
                            createElement('button', { onClick: formatCode, className: 'themed-btn-secondary px-7 py-3 rounded-2xl font-black text-xs uppercase hover:scale-105 transition-transform' }, 'Format'),
                            createElement('button', { onClick: () => onDeploy(cmInstance.current.getValue()), className: 'themed-btn px-10 py-3 rounded-2xl text-xs font-black uppercase tracking-widest hover:scale-105 transition-transform' }, 'Deploy'),
                            createElement('button', { onClick: downloadCode, className: 'themed-btn-secondary px-7 py-3 rounded-2xl font-black text-xs uppercase hover:scale-105 transition-transform' }, 'Archive'),
                            createElement('button', { onClick: onClose, className: 'bg-red-500/10 text-red-500 px-7 py-3 rounded-2xl font-black text-xs uppercase hover:bg-red-500/20' }, 'Kill Node')
                        )
                    ),
                    createElement('div', { ref: editorHostRef, className: 'flex-1 overflow-hidden themed-border-top' })
                )
            );
        };

        const GameCard = ({ zone, variant = 'normal', onClick }) => {
            const isHot = HOT_TITLES.includes(zone.name);
            const isFeatured = FEATURED_TITLES.includes(zone.name);
            const sizeClasses = { 
                hero: 'aspect-square w-full h-full', 
                wide: 'aspect-video w-full', 
                normal: 'aspect-[3/4] w-full', 
                carousel: 'aspect-[3/4] w-[220px] flex-shrink-0', 
                vault: 'aspect-[3/4] w-full' 
            };
            const coverSrc = zone.isLocal ? 'https://cdn.jsdelivr.net/gh/gn-math/assets@main/local_game_cover.png' : 
                            (zone.cover.includes("{COVER_URL}") ? zone.cover.replace("{COVER_URL}", COVER_BASE) : zone.cover);

            return createElement(InteractiveTilt, { className: sizeClasses[variant] },
                createElement(motion.div, { 
                    whileTap: { scale: 0.98 },
                    onClick, className: 'group glass rounded-[2.5rem] overflow-hidden cursor-pointer w-full h-full relative' 
                },
                    createElement('img', { src: coverSrc, className: 'w-full h-full object-cover transition-transform duration-1000 cubic-bezier(0.19, 1, 0.22, 1) group-hover:scale-110', loading: 'lazy' }),
                    createElement('div', { className: 'absolute inset-0 bg-gradient-to-t from-black/95 via-black/10 to-transparent' }),
                    createElement('div', { className: 'absolute top-4 left-4 flex gap-2' },
                        isHot && createElement('span', { className: 'badge' }, 'ðŸ”¥'),
                        isFeatured && createElement('span', { className: 'badge' }, 'â­'),
                        zone.isLocal && createElement('span', { className: 'badge !bg-sky-500 !text-white' }, 'DEV')
                    ),
                    createElement('div', { className: 'absolute bottom-0 left-0 right-0 p-8' },
                        createElement('p', { className: `font-bold truncate text-white uppercase italic tracking-[0.1em] ${variant === 'hero' ? 'text-4xl' : 'text-[11px]'}` }, zone.name)
                    )
                )
            );
        };

        const GamePlayer = ({ zone, onClose }) => {
            const [isLoading, setIsLoading] = useState(true);
            const [playerUrl, setPlayerUrl] = useState('');
            const containerRef = useRef(null);

            useEffect(() => {
                const resolveAndLoad = async () => {
                    setIsLoading(true);
                    let finalUrl = zone.url;
                    if (!zone.isLocal && !zone.isIDE && finalUrl.includes("{HTML_URL}")) finalUrl = zone.url.replace("{HTML_URL}", HTML_BASE);

                    const isSingleHtml = finalUrl.endsWith(".html") && !zone.isUnity && !zone.isLocal && !zone.isIDE;

                    if (isSingleHtml) {
                        try {
                            const res = await fetch(finalUrl);
                            var html = await res.text();
                            if (html.includes("createUnityInstance")) {
                                const parser = new DOMParser();
                                var doc = parser.parseFromString(html, "text/html");
                                doc.head.innerHTML += `
                                <script src="https://cdn.jsdelivr.net/gh/Zotronix/Ignis-Games/Games/fixes.js"><\/script>
                                <script>
                                  const origAppendChild = Node.prototype.appendChild;
                                  Node.prototype.appendChild = function (node) {
                                    if (node.tagName === 'SCRIPT' && node.src) {
                                      if (node.src.endsWith('.loader.js')) {
                                        const prevSrc = node.src;
                                        node.remove();
                                        changeUnityLoader(prevSrc).then(loaderUrl => {
                                          const script = document.createElement('script');
                                          script.src = loaderUrl;
                                          script.onload = () => {
                                            createUnityInstance(canvas, config, (progress) => {
                                              progressBarFull.style.width = (100 * progress) + '%';
                                            })
                                              .then((unityInstance) => {
                                                unityGameInstance = unityInstance;
                                                loadingBar.style.display = 'none';
                                              })
                                              .catch((message) => {
                                                console.error(message);
                                              });
                                          };
                                          document.body.appendChild(script);
                                        });
                                      } else { return origAppendChild.call(this, node); }
                                    } else { return origAppendChild.call(this, node); }
                                  };
                                <\/script>`;
                                html = doc.documentElement.outerHTML;
                            }
                            if (html.includes("https://cdn.jsdelivr.net/gh/bubbls/youtube-playables@main/ytgame.js")) {
                                html = html.replaceAll("https://cdn.jsdelivr.net/gh/bubbls/youtube-playables@main/ytgame.js", "https://cdn.jsdelivr.net/gh/Zotronix/Ignis-Games@main/Games/Crossy%20Road/ytgame.js");
                            }
                            const blob = new Blob([html], { type: "text/html" });
                            setPlayerUrl(URL.createObjectURL(blob));
                        } catch (e) { setPlayerUrl(finalUrl); }
                    } else { setPlayerUrl(finalUrl); }
                    setIsLoading(false);
                };
                resolveAndLoad();
                return () => { if (playerUrl && playerUrl.startsWith('blob:')) URL.revokeObjectURL(playerUrl); };
            }, [zone]);

            return createElement(motion.div, { 
                initial: { opacity: 0 }, animate: { opacity: 1 }, transition: { duration: 0.8 },
                className: `fixed inset-0 z-[120] bg-black flex flex-col` 
            },
                createElement('header', { className: 'glass px-8 py-5 flex items-center justify-between border-b border-white/10' },
                    createElement('span', { className: 'text-white font-bold text-[12px] uppercase tracking-[0.3em] opacity-80' }, zone.name),
                    createElement('div', { className: 'flex gap-4' },
                        createElement('button', { onClick: () => containerRef.current?.requestFullscreen(), className: 'px-8 py-2.5 glass rounded-2xl text-[11px] font-bold uppercase hover:bg-white/10' }, 'fullscreen'),
                        createElement('button', { onClick: onClose, className: 'px-8 py-2.5 bg-red-500/10 text-red-500 rounded-2xl text-[11px] font-bold uppercase hover:bg-red-500/20' }, 'go bye bye')
                    )
                ),
                createElement('div', { ref: containerRef, className: 'flex-1 relative bg-black' },
                    isLoading && createElement('div', { className: 'absolute inset-0 flex items-center justify-center' }, createElement('div', { className: 'w-12 h-12 border-2 border-white/10 border-t-white rounded-full animate-spin' })),
                    playerUrl && createElement('iframe', { src: playerUrl, className: `w-full h-full border-none`, allow: "fullscreen; autoplay; gamepad; microphone; camera; midi; encrypted-media", referrerPolicy: "no-referrer" })
                )
            );
        };

        const HomeView = ({ onNavigate, onSearch }) => {
            const [query, setQuery] = useState("");
            const [glows, setGlows] = useState({ a: false, z: false });

            useEffect(() => {
                const interval = setInterval(() => {
                    setGlows({ a: Math.random() > 0.5, z: Math.random() > 0.5 });
                }, 3000);
                return () => clearInterval(interval);
            }, []);

            return createElement(motion.div, { 
                initial: { opacity: 0, y: 30 }, animate: { opacity: 1, y: 0 }, exit: { opacity: 0, scale: 0.95 }, 
                transition: { duration: 0.8, ease: [0.19, 1, 0.22, 1] },
                className: 'home-container px-6' 
            },
                createElement(InteractiveTilt, { rotate: 8, scale: 1.06 },
                    createElement('h1', { className: 'home-title select-none' }, 'nexus'),
                    createElement('p', { className: 'home-subtitle select-none' }, 'imagine if we were all autistic goldfish')
                ),
                createElement(InteractiveTilt, { className: 'search-container', scale: 1.02, rotate: 6 },
                    createElement('div', { className: 'search-bar group' },
                        createElement('svg', { className: 'w-6 h-6 text-slate-700 transition-colors group-focus-within:text-white', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' }, createElement('path', { d: 'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z' })),
                        createElement('input', { 
                            type: 'text', placeholder: 'i do the search thingies.', value: query, 
                            onChange: e => setQuery(e.target.value),
                            onKeyDown: e => { if (e.key === 'Enter') { onSearch(query); onNavigate('games'); } }
                        })
                    )
                ),
                createElement('div', { className: 'stat-row select-none' },
                    createElement('span', { className: 'flex items-center gap-3 transition-all' }, createElement('div', { className: `stat-dot ${glows.a ? 'glow' : ''}` }), 'abmin'),
                    createElement('span', { className: 'opacity-20' }, 'Â·'),
                    createElement('span', { className: 'flex items-center gap-3 transition-all' }, createElement('div', { className: `stat-dot ${glows.z ? 'glow' : ''}` }), 'zotronix')
                ),
                createElement('div', { className: 'flex flex-col items-center opacity-40 gap-3 mt-16' },
                    createElement('p', { className: 'text-[11px] font-black uppercase tracking-[0.6em] text-white/50' }, 'have fun!'),
                    createElement('div', { className: 'flex gap-10 text-[12px] font-bold uppercase italic tracking-widest' },
                        createElement('a', { href: '#', className: 'hover:text-white transition-all hover:scale-105' }, 'by'),
                        createElement('span', { className: 'opacity-10' }, '|'),
                        createElement('a', { href: '#', className: 'hover:text-white transition-all hover:scale-105' }, 'jjh')
                    )
                )
            );
        };

        const App = () => {
            const [zones, setZones] = useState([]);
            const [search, setSearch] = useState("");
            const [activeTab, setActiveTab] = useState('home');
            const [activeZone, setActiveZone] = useState(null);
            const [currentTheme, setCurrentTheme] = useState('dark');
            const [cloak, setCloak] = useState('Nexus');
            const [settingsOpen, setSettingsOpen] = useState(false);
            const [showIDE, setShowIDE] = useState(false);
            const fileRef = useRef(null);

            useEffect(() => { 
                const loadGames = async () => {
                    const adminGames = ["Add Message", "Push Games"];
                    try {
                        const [nexusRes, zotronixRes, abminnRes] = await Promise.allSettled([
                            fetch(ZONES_URL).then(r => r.json()),
                            fetch(ZOTRONIX_API).then(r => r.json()),
                            fetch(ABMINN_API).then(r => r.json())
                        ]);

                        // Helper to process GitHub repo contents
                        const processGitHubRepo = (res, base, images) => {
                            if (res.status !== 'fulfilled' || !Array.isArray(res.value)) return [];
                            return res.value
                                .filter(item => item.type === 'dir' && !adminGames.includes(item.name))
                                .map(folder => ({
                                    name: folder.name.replace(/%20/g, ' '),
                                    url: `${base}${folder.name}/index.html`,
                                    cover: `${images}${folder.name}.png`,
                                    id: `${folder.name.toLowerCase().replace(/\s/g, '-')}`
                                }));
                        };

                        const zotronixGames = processGitHubRepo(zotronixRes, ZOTRONIX_BASE, ZOTRONIX_IMAGES);
                        const abminnGames = processGitHubRepo(abminnRes, ABMINN_BASE, ABMINN_IMAGES);
                        const nexusGames = nexusRes.status === 'fulfilled' ? nexusRes.value : [];

                        // Deduplication Strategy: Normalized name map
                        // PRIORITY: Zotronix (High) > Abminn > Nexus (Base)
                        const uniqueMap = new Map();

                        // 1. Add Nexus base first (lowest priority)
                        nexusGames.forEach(game => {
                            const key = game.name.toLowerCase().trim().replace(/\s/g, '');
                            uniqueMap.set(key, game);
                        });

                        // 2. Add Abminn (will overwrite Nexus duplicates)
                        abminnGames.forEach(game => {
                            const key = game.name.toLowerCase().trim().replace(/\s/g, '');
                            uniqueMap.set(key, game);
                        });

                        // 3. Add Zotronix (highest priority, will overwrite everything)
                        zotronixGames.forEach(game => {
                            const key = game.name.toLowerCase().trim().replace(/\s/g, '');
                            uniqueMap.set(key, game);
                        });

                        setZones(Array.from(uniqueMap.values()));
                    } catch (error) {
                        console.error("Game loading failed:", error);
                        // Safe fallback to base zones if all else fails
                        fetch(ZONES_URL).then(r => r.json()).then(setZones).catch(() => {});
                    }
                };
                loadGames();
            }, []);

            useEffect(() => { 
                document.title = cloak || 'Nexus'; 
                document.body.className = THEMES.find(t => t.id === currentTheme)?.class || ''; 
            }, [currentTheme, cloak]);

            useEffect(() => {
                const handleBeforeUnload = (e) => {
                    e.preventDefault();
                    e.returnValue = 'Unsaved work will be lost.';
                };
                window.addEventListener('beforeunload', handleBeforeUnload);
                return () => window.removeEventListener('beforeunload', handleBeforeUnload);
            }, []);

            const filteredData = useMemo(() => {
                const results = zones.filter(z => z.name.toLowerCase().includes(search.toLowerCase()));
                if (results.length === 0 && search !== "") return null;
                const featured = results.filter(z => FEATURED_TITLES.includes(z.name));
                const hot = results.filter(z => HOT_TITLES.includes(z.name));
                const hero = featured.find(f => f.name === FEATURED_TITLES[0]) || featured[0];
                const restFeatured = featured.filter(f => f !== hero);
                const alpha = {};
                results.forEach(z => { 
                    let c = z.name[0].toUpperCase(); 
                    if (/[0-9]/.test(c)) c = '#'; 
                    if (!alpha[c]) alpha[c] = []; alpha[c].push(z); 
                });
                return { hero, restFeatured, hot, alpha: Object.keys(alpha).sort().map(k => ({ char: k, games: alpha[k] })) };
            }, [zones, search]);

            return createElement('div', { className: 'min-h-screen flex flex-col' },
                createElement('div', { className: 'sidebar-trigger' }),
                createElement('aside', { className: 'sidebar flex flex-col p-9 gap-12' },
                    createElement('div', { className: 'flex items-center gap-5' }, 
                        createElement('div', { className: 'w-11 h-11 themed-btn rounded-2xl flex items-center justify-center text-2xl shadow-[0_0_20px_rgba(var(--accent-rgb),0.1)]' }, 'N'), 
                        createElement('span', { className: 'font-black italic text-2xl text-white tracking-tighter uppercase' }, 'NEXUS')
                    ),
                    createElement('nav', { className: 'flex-1 flex flex-col gap-3' },
                        createElement('button', { onClick: () => { setActiveTab('home'); setSearch(""); }, className: `sidebar-item ${activeTab === 'home' ? 'active' : ''}` }, createElement(HomeIcon), 'launch menu'),
                        createElement('button', { onClick: () => setActiveTab('games'), className: `sidebar-item ${activeTab === 'games' ? 'active' : ''}` }, createElement(GameIcon), 'games'),
                        createElement('button', { onClick: () => setActiveTab('anime'), className: `sidebar-item ${activeTab === 'anime' ? 'active' : ''}` }, createElement(AnimeIcon), 'anime'),
                        createElement('button', { onClick: () => setActiveTab('manga'), className: `sidebar-item ${activeTab === 'manga' ? 'active' : ''}` }, createElement(MangaIcon), 'manga'),
                        createElement('button', { onClick: () => setActiveTab('art'), className: `sidebar-item ${activeTab === 'art' ? 'active' : ''}` }, createElement(ArtIcon), 'art studio'),
                        createElement('button', { onClick: () => setActiveTab('utilities'), className: `sidebar-item ${activeTab === 'utilities' ? 'active' : ''}` }, createElement(ToolIcon), 'tools n stuff')
                    ),
                    createElement('button', { onClick: () => setSettingsOpen(true), className: 'sidebar-item mt-auto border border-white/5 bg-white/5' }, 'Config Settings')
                ),

                activeTab !== 'home' && createElement(Fragment, null,
                    createElement('div', { className: 'header-trigger' }),
                    createElement('header', { className: 'header-bar glass px-12 py-8 border-b border-white/5 flex items-center justify-between' },
                        createElement('h1', { className: 'text-2xl font-black italic text-white uppercase tracking-tighter' }, activeTab),
                        createElement('div', { className: 'flex gap-5' },
                            activeTab === 'games' && createElement('input', { className: 'w-96 px-8 py-4 rounded-3xl bg-white/5 border border-white/5 text-white text-sm outline-none focus:border-white/20 transition-all placeholder:opacity-30', placeholder: 'go on, search something.', value: search, onChange: e => setSearch(e.target.value) }),
                            createElement('button', { onClick: () => setSettingsOpen(true), className: 'p-4 glass rounded-3xl hover:bg-white/10 transition-all text-slate-500 hover:text-white' }, 'âš™ï¸')
                        )
                    )
                ),

                createElement('main', { className: `${activeTab === 'home' ? '' : 'max-w-[150rem] mx-auto w-full py-24 px-12'}` },
                    createElement(AnimatePresence, { mode: 'wait' },
                        activeTab === 'home' ? (
                            createElement(HomeView, { key: 'home', onNavigate: setActiveTab, onSearch: setSearch })
                        ) : activeTab === 'games' ? (
                            createElement(motion.div, { key: 'games', initial: { opacity: 0, x: 20 }, animate: { opacity: 1, x: 0 }, exit: { opacity: 0, x: -20 }, transition: { duration: 0.7, ease: [0.19, 1, 0.22, 1] } },
                                !filteredData ? (
                                    createElement('div', { className: 'whoopies-box' },
                                        createElement('svg', { className: 'whoopies-guy', viewBox: '0 0 24 24' }, createElement('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h2V9H7v2zm8 0h2V9h-2v2zm-3 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z' })),
                                        createElement('div', { className: 'text-center' },
                                            createElement('h2', { className: 'text-3xl font-black italic uppercase text-white tracking-tight' }, "oops! nothing here atm,"),
                                            createElement('p', { className: 'text-slate-600 font-medium text-lg mt-2' }, "but yknow where to find me if you need it!")
                                        )
                                    )
                                ) : (
                                    createElement(React.Fragment, null,
                                        !search && createElement('section', { className: 'space-y-16 mb-40' },
                                            createElement('h2', { className: 'section-header text-4xl' }, 'Daily Spotlight'),
                                            createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-[repeat(13,minmax(0,1fr))] gap-10' },
                                                createElement('div', { className: 'lg:col-span-8 lg:col-start-1' }, filteredData.hero && createElement(GameCard, { variant: 'hero', zone: filteredData.hero, onClick: () => setActiveZone(filteredData.hero) })),
                                                createElement('div', { className: 'lg:col-span-5 lg:col-start-9 flex flex-col gap-10' }, filteredData.restFeatured.slice(0, 2).map(g => createElement(GameCard, { key: g.id, variant: 'wide', zone: g, onClick: () => setActiveZone(g) }))),
                                                createElement('div', { className: 'lg:col-span-13 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-10' }, filteredData.restFeatured.slice(2, 8).map(g => createElement(GameCard, { key: g.id, zone: g, onClick: () => setActiveZone(g) })))
                                            )
                                        ),
                                        createElement('section', { className: 'space-y-10 mb-40' },
                                            createElement('h2', { className: 'section-header text-4xl' }, 'Hot Right Now'),
                                            createElement('div', { className: 'flex gap-10 overflow-x-auto pb-12 visible-scroll' },
                                                filteredData.hot.map(g => createElement(GameCard, { key: g.id, variant: 'carousel', zone: g, onClick: () => setActiveZone(g) }))
                                            )
                                        ),
                                        createElement('section', { className: 'space-y-24' }, filteredData.alpha.map(block => createElement('div', { key: block.char, className: 'vault-section mb-28' },
                                            createElement('div', { className: 'letter-header flex items-center gap-10 mb-16' }, createElement('div', { className: 'letter-circle' }, block.char), createElement('div', { className: 'flex-1 h-px bg-white/5' })),
                                            createElement('div', { className: 'vault-grid' }, block.games.map(g => createElement(GameCard, { key: g.id, variant: 'vault', zone: g, onClick: () => setActiveZone(g) })))
                                        )))
                                    )
                                )
                            )
                        ) : activeTab === 'anime' ? (
                            createElement(motion.div, { key: 'anime', initial: { opacity: 0, scale: 0.98 }, animate: { opacity: 1, scale: 1 }, exit: { opacity: 0, scale: 0.95 }, transition: { duration: 0.7, ease: [0.19, 1, 0.22, 1] }, className: 'space-y-12 h-[85vh] flex flex-col' },
                                createElement('div', { className: 'flex justify-between items-center px-4' },
                                    createElement('div', null, createElement('h2', { className: 'text-5xl font-black italic text-white uppercase tracking-tighter' }, 'Anime Portal'), createElement('p', { className: 'text-slate-600 font-medium text-lg' }, 'Encrypted high-bitrate streaming pipeline.')),
                                    createElement('button', { onClick: () => document.getElementById('anime-frame').requestFullscreen(), className: 'px-14 py-4 themed-btn rounded-3xl uppercase tracking-[0.3em] text-[11px]' }, 'Enter Fullscale')
                                ),
                                createElement('div', { className: 'flex-1 glass rounded-[4rem] overflow-hidden' },
                                    createElement('iframe', { id: 'anime-frame', src: 'https://hianime.to', className: 'w-full h-full border-none', sandbox: 'allow-forms allow-scripts allow-same-origin allow-presentation', allow: 'fullscreen; autoplay; encrypted-media', referrerPolicy: 'no-referrer' })
                                )
                            )
                        ) : activeTab === 'manga' ? (
                            createElement(motion.div, { key: 'manga', initial: { opacity: 0, scale: 0.98 }, animate: { opacity: 1, scale: 1 }, exit: { opacity: 0, scale: 0.95 }, transition: { duration: 0.7, ease: [0.19, 1, 0.22, 1] }, className: 'space-y-12 h-[85vh] flex flex-col' },
                                createElement('div', { className: 'flex justify-between items-center px-4' },
                                    createElement('div', null, createElement('h2', { className: 'text-5xl font-black italic text-white uppercase tracking-tighter' }, 'Manga Portal'), createElement('p', { className: 'text-slate-600 font-medium text-lg' }, 'Secure archival manuscript uplink.')),
                                    createElement('button', { onClick: () => document.getElementById('manga-frame').requestFullscreen(), className: 'px-14 py-4 themed-btn rounded-3xl uppercase tracking-[0.3em] text-[11px]' }, 'Enter Fullscale')
                                ),
                                createElement('div', { className: 'flex-1 glass rounded-[4rem] overflow-hidden' },
                                    createElement('iframe', { id: 'manga-frame', src: 'https://weebcentral.com', className: 'w-full h-full border-none', sandbox: 'allow-forms allow-scripts allow-same-origin allow-presentation', allow: 'fullscreen; autoplay; encrypted-media', referrerPolicy: 'no-referrer' })
                                )
                            )
                        ) : activeTab === 'art' ? (
                            createElement(ArtView, { key: 'art' })
                        ) : (
                            createElement(motion.div, { key: 'utils', initial: { opacity: 0, y: 30 }, animate: { opacity: 1, y: 0 }, exit: { opacity: 0, y: -30 }, transition: { duration: 0.7, ease: [0.19, 1, 0.22, 1] }, className: 'max-w-6xl mx-auto space-y-28' },
                                createElement('div', { className: 'text-center' }, createElement('h2', { className: 'text-7xl font-black italic text-white uppercase tracking-tighter' }, 'Utilities'), createElement('p', { className: 'text-slate-600 text-2xl mt-6' }, 'Nexus developer toolchain.')),
                                createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-16' },
                                    createElement(InteractiveTilt, null,
                                        createElement('div', { onClick: () => setShowIDE(true), className: 'group utility-card glass rounded-[4rem] cursor-pointer' },
                                            createElement('h3', { className: 'text-4xl font-black italic text-white uppercase tracking-tighter' }, 'IDE Workspace'),
                                            createElement('p', { className: 'text-xs text-slate-600 font-black uppercase mt-6 tracking-[0.4em]' }, 'Code / Deploy / Save Archive')
                                        )
                                    ),
                                    createElement(InteractiveTilt, null,
                                        createElement('div', { onClick: () => fileRef.current?.click(), className: 'group utility-card glass rounded-[4rem] cursor-pointer' },
                                            createElement('input', { type: 'file', ref: fileRef, accept: '.html', className: 'hidden', onChange: e => e.target.files[0] && setActiveZone({ name: e.target.files[0].name, url: URL.createObjectURL(e.target.files[0]), isLocal: true }) }),
                                            createElement('h3', { className: 'text-4xl font-black italic text-white uppercase tracking-tighter' }, 'Node Upload'),
                                            createElement('p', { className: 'text-xs text-slate-600 font-black uppercase mt-6 tracking-[0.4em]' }, 'Run Local HTML Assets')
                                        )
                                    )
                                )
                            )
                        )
                    )
                ),

                activeTab === 'home' && createElement('div', { className: 'dock-wrapper' },
                    createElement(InteractiveTilt, { scale: 1.12, rotate: 6 },
                        createElement(motion.div, { initial: { opacity: 0, y: 40 }, animate: { opacity: 1, y: 0 }, transition: { duration: 1, delay: 0.2, ease: [0.19, 1, 0.22, 1] }, className: 'dock shadow-2xl border border-white/10 backdrop-blur-3xl' },
                            createElement('div', { className: 'dock-btn', onClick: () => setActiveTab('games') }, createElement(GameIcon), createElement('div', { className: 'tooltip' }, 'games')),
                            createElement('div', { className: 'dock-btn', onClick: () => setActiveTab('anime') }, createElement(AnimeIcon), createElement('div', { className: 'tooltip' }, 'anime')),
                            createElement('div', { className: 'dock-btn', onClick: () => setActiveTab('manga') }, createElement(MangaIcon), createElement('div', { className: 'tooltip' }, 'manga')),
                            createElement('div', { className: 'dock-btn', onClick: () => setActiveTab('art') }, createElement(ArtIcon), createElement('div', { className: 'tooltip' }, 'art')),
                            createElement('div', { className: 'dock-btn', onClick: () => setActiveTab('utilities') }, createElement(ToolIcon), createElement('div', { className: 'tooltip' }, 'tools'))
                        )
                    )
                ),

                showIDE && createElement(IDE, { onClose: () => setShowIDE(false), onDeploy: code => setActiveZone({ name: 'Development Node', url: URL.createObjectURL(new Blob([code], { type: "text/html" })), isIDE: true }) }),
                activeZone && createElement(GamePlayer, { zone: activeZone, onClose: () => setActiveZone(null) }),
                settingsOpen && createElement(SettingsModal, { onClose: () => setSettingsOpen(false), currentTheme, onThemeChange: setCurrentTheme, currentCloak: cloak, onCloakChange: setCloak })
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(createElement(App));
    </script>
</body>

</html>
