<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/gn-math/gn-math.github.io@main/favicon.png">
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.3.1",
    "react-dom": "https://esm.sh/react-dom@18.3.1",
    "react-dom/client": "https://esm.sh/react-dom@18.3.1/client"
  }
}
</script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');
        
        :root {
            --bg-color: #020617;
            --accent-color: #8b5cf6;
            --accent-rgb: 139, 92, 246;
            --text-color: #f1f5f9;
            --glass-color: rgba(15, 23, 42, 0.7);
            --glow: 0 0 30px rgba(var(--accent-rgb), 0.3);
        }

        body.theme-amoled { --bg-color: #000000; --accent-color: #ffffff; --accent-rgb: 255, 255, 255; --glass-color: rgba(0, 0, 0, 0.85); --glow: 0 0 15px rgba(255, 255, 255, 0.2); }
        body.theme-cyber { --bg-color: #050505; --accent-color: #00ff41; --accent-rgb: 0, 255, 65; --glass-color: rgba(6, 15, 6, 0.8); --glow: 0 0 20px rgba(0, 255, 65, 0.4); }
        body.theme-rose { --bg-color: #1a0a0f; --accent-color: #fb7185; --accent-rgb: 251, 113, 133; --glass-color: rgba(45, 10, 20, 0.8); --glow: 0 0 25px rgba(251, 113, 133, 0.3); }
        body.theme-gold { --bg-color: #0c0a06; --accent-color: #fbbf24; --accent-rgb: 251, 191, 36; --glass-color: rgba(25, 20, 10, 0.8); --glow: 0 0 20px rgba(251, 191, 36, 0.3); }
        body.theme-admin-hellfire { --bg-color: #050000; --accent-color: #ff0000; --accent-rgb: 255, 0, 0; --glass-color: rgba(20, 0, 0, 0.9); --glow: 0 0 30px rgba(255, 0, 0, 0.6); }

        body { 
            font-family: 'Space Grotesk', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            margin: 0; 
            transition: all 0.4s ease;
            overflow-x: hidden;
        }

        .animated-bg { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; 
            background: radial-gradient(circle at 50% 50%, rgba(var(--accent-rgb), 0.1) 0%, var(--bg-color) 100%); 
        }

        .glass { background: var(--glass-color); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(var(--accent-rgb), 0.1); }
        .accent-text { color: var(--accent-color); }
        .accent-bg { background-color: var(--accent-color); }
        .accent-glow { box-shadow: var(--glow); }

        .game-card-hover { transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .game-card-hover:hover { 
            transform: translateY(-5px) scale(1.02); 
            box-shadow: 0 12px 30px -10px rgba(var(--accent-rgb), 0.4);
            border-color: var(--accent-color);
        }

        .visible-scroll {
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) rgba(255, 255, 255, 0.05);
        }
        .visible-scroll::-webkit-scrollbar { height: 6px; }
        .visible-scroll::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
        .visible-scroll::-webkit-scrollbar-thumb { background: var(--accent-color); border-radius: 10px; }

        .section-header {
            border-left: 5px solid var(--accent-color);
            padding-left: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge {
            background: rgba(var(--accent-rgb), 0.9);
            backdrop-filter: blur(4px);
            padding: 1px 6px;
            border-radius: 4px;
            font-size: 8px;
            font-weight: 800;
            color: black;
        }

        @keyframes logoSpin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .logo-ring { border: 2px solid var(--accent-color); border-top-color: transparent; animation: logoSpin 4s linear infinite; }
        .logo-ring-inner { border: 2px solid var(--accent-color); border-bottom-color: transparent; animation: logoSpin 2s linear reverse infinite; }

        .modal-fade-in { animation: fadeIn 0.25s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        .sidebar-trigger {
            position: fixed;
            top: 0;
            left: 0;
            width: 60px; 
            height: 100vh;
            z-index: 100;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -280px;
            width: 260px;
            height: 100vh;
            z-index: 101;
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            background: rgba(var(--accent-rgb), 0.05);
            backdrop-filter: blur(25px);
            border-right: 1px solid rgba(var(--accent-rgb), 0.1);
            box-shadow: 20px 0 50px -10px rgba(0, 0, 0, 0.5);
        }

        .sidebar-trigger:hover + .sidebar,
        .sidebar:hover {
            left: 0;
        }

        .sidebar-item {
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            width: 100%;
            border-radius: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-size: 0.875rem;
        }
        .sidebar-item:hover {
            background: rgba(var(--accent-rgb), 0.1);
            padding-left: 2rem;
            color: var(--accent-color);
        }
        .sidebar-item.active {
            background: rgba(var(--accent-rgb), 0.15);
            border-left: 4px solid var(--accent-color);
            color: var(--accent-color);
            text-shadow: 0 0 10px rgba(var(--accent-rgb), 0.5);
        }
        .sidebar-icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
            transition: transform 0.3s ease;
        }
        .sidebar-item:hover .sidebar-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .vault-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 4rem;
        }

        .letter-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            user-select: none;
        }

        .letter-circle {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(var(--accent-rgb), 0.05);
            border: 1px solid rgba(var(--accent-rgb), 0.1);
            border-radius: 12px;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--accent-color);
        }

        .letter-line {
            flex: 1;
            height: 1px;
            background: linear-gradient(to right, rgba(var(--accent-rgb), 0.2), transparent);
        }

        .vault-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        @media (min-width: 640px) { .vault-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (min-width: 1024px) { .vault-grid { grid-template-columns: repeat(5, 1fr); } }
        @media (min-width: 1280px) { .vault-grid { grid-template-columns: repeat(6, 1fr); } }
        @media (min-width: 1536px) { .vault-grid { grid-template-columns: repeat(7, 1fr); } }

        /* Code Editor Specifics */
        .smart-editor {
            font-family: 'Fira Code', monospace;
            line-height: 1.6;
            resize: none;
            outline: none;
            tab-size: 4;
        }
        .suggestion-box {
            position: absolute;
            z-index: 1000;
            min-width: 200px;
            max-height: 250px;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .suggestion-item.active {
            background: var(--accent-color);
            color: black;
        }
    </style>
</head>
<body>
    <div class="animated-bg" id="star-field"></div>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, createElement, useMemo, useRef } from 'react';
        import ReactDOM from 'react-dom/client';

        const ZONES_URL = "https://cdn.jsdelivr.net/gh/gn-math/assets@main/zones.json";
        const COVER_BASE = "https://cdn.jsdelivr.net/gh/gn-math/covers@main";
        const HTML_BASE = "https://cdn.jsdelivr.net/gh/gn-math/html@main";

        const HOT_TITLES = ["Buckshot Roulette", "ULTRAKILL", "Pizza Tower", "R.E.P.O", "People Playground", "Sprunki", "WebFishing", "Blade Ball"];
        const FEATURED_TITLES = ["Minecraft 1.21.4", "Geometry Dash Lite", "Retro Bowl", "Friday Night Funkin", "Happy Wheels", "Slope", "Papa's Freezeria", "Cookie Clicker", "Plants vs Zombies", "Retro Bowl College"];

        const THEMES = [
            { id: 'dark', name: 'Cosmic Dark', class: '' },
            { id: 'amoled', name: 'True Black', class: 'theme-amoled' },
            { id: 'cyber', name: 'Cyber Neon', class: 'theme-cyber' },
            { id: 'rose', name: 'Rose Nebula', class: 'theme-rose' },
            { id: 'gold', name: 'Golden Sun', class: 'theme-gold' }
        ];

        const HTML_TAGS = ['div', 'span', 'p', 'h1', 'h2', 'h3', 'section', 'article', 'main', 'header', 'footer', 'nav', 'aside', 'button', 'input', 'img', 'a', 'ul', 'ol', 'li', 'form', 'label', 'canvas', 'video', 'audio', 'details', 'summary', 'dialog'];
        const VOID_TAGS = ['img', 'input', 'br', 'hr', 'meta', 'link'];
        const ATTRIBUTES = ['class', 'id', 'src', 'href', 'style', 'type', 'placeholder', 'value', 'onclick', 'width', 'height', 'loading'];

        const GameIcon = () => createElement('svg', { className: 'sidebar-icon', viewBox: '0 0 24 24' },
            createElement('path', { d: 'M21,6H3C1.9,6,1,6.9,1,8v8c0,1.1,0.9,2,2,2h18c1.1,0,2-0.9,2-2V8C23,6.9,22.1,6,21,6z M18,15c-0.55,0-1-0.45-1-1s0.45-1,1-1s1,0.45,1,1S18.55,15,18,15z M20,12c-0.55,0-1-0.45-1-1s0.45-1,1-1s1,0.45,1,1S20.55,12,20,12z M11,13H9v2H8v-2H6v-1h2V10h1v2h2V13z' })
        );

        const UtilityIcon = () => createElement('svg', { className: 'sidebar-icon', viewBox: '0 0 24 24' },
            createElement('path', { d: 'M22.7,19l-9.1-9.1c0.9-2.3,0.4-5-1.5-6.9c-2-2-5-2.4-7.4-1.3L9,6.5L6.5,9L1.7,4.2c-1.1,2.4-0.7,5.4,1.3,7.4c1.9,1.9,4.5,2.4,6.9,1.5l9.1,9.1c0.4,0.4,1,0.4,1.4,0l2.3-2.3C23.1,19.9,23.1,19.3,22.7,19z' })
        );

        const GameCard = ({ zone, variant = 'normal', onClick }) => {
            const isHot = HOT_TITLES.includes(zone.name);
            const isFeatured = FEATURED_TITLES.includes(zone.name);
            const sizeClasses = { hero: 'aspect-square w-full h-full', wide: 'aspect-video w-full', normal: 'aspect-[3/4] w-full', carousel: 'aspect-[3/4] w-[160px] flex-shrink-0', vault: 'aspect-[3/4] w-full' };
            const coverSrc = zone.isLocal ? 'https://cdn.jsdelivr.net/gh/gn-math/assets@main/local_game_cover.png' : zone.cover.replace("{COVER_URL}", COVER_BASE);

            return createElement('div', { onClick, className: `group relative glass rounded-xl overflow-hidden cursor-pointer game-card-hover border border-white/5 ${sizeClasses[variant]}` },
                createElement('img', { src: coverSrc, className: 'w-full h-full object-cover transition-transform duration-700 group-hover:scale-110', loading: 'lazy' }),
                createElement('div', { className: 'absolute inset-0 bg-gradient-to-t from-black via-black/10 to-transparent' }),
                createElement('div', { className: 'absolute top-2 left-2 flex gap-1' },
                    isHot && createElement('span', { className: 'badge' }, 'ðŸ”¥'),
                    isFeatured && createElement('span', { className: 'badge' }, 'â­'),
                    zone.isLocal && createElement('span', { className: 'badge !bg-blue-500' }, 'LOCAL')
                ),
                createElement('div', { className: 'absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300' },
                    createElement('div', { className: 'w-10 h-10 accent-bg accent-glow rounded-full flex items-center justify-center scale-90 group-hover:scale-100 transition-transform' },
                        createElement('svg', { viewBox: "0 0 24 24", className: "w-6 h-6 text-black ml-0.5", fill: "currentColor" }, createElement('path', { d: "M8 5v14l11-7z" }))
                    )
                ),
                createElement('div', { className: 'absolute bottom-0 left-0 right-0 p-3' },
                    createElement('p', { className: `font-bold truncate text-white uppercase italic ${variant === 'hero' ? 'text-lg' : 'text-[11px]'}` }, zone.name)
                )
            );
        };

        const IDE = ({ onDeploy }) => {
            const [code, setCode] = useState('<!-- Nexus IDE v4.0 -->\n<div class="container">\n    <h1>New Project</h1>\n</div>');
            const [suggestions, setSuggestions] = useState([]);
            const [selectedIndex, setSelectedIndex] = useState(0);
            const [suggestPos, setSuggestPos] = useState({ x: 0, y: 0 });
            const textareaRef = useRef(null);

            const memory = useMemo(() => {
                const ids = code.match(/id="([^"]*)"/g)?.map(m => m.slice(4, -1)) || [];
                const classes = code.match(/class="([^"]*)"/g)?.map(m => m.slice(7, -1)) || [];
                return { ids: [...new Set(ids)], classes: [...new Set(classes)] };
            }, [code]);

            const handleKeyDown = (e) => {
                const area = textareaRef.current;
                const { selectionStart, selectionEnd, value } = area;

                if (suggestions.length > 0) {
                    if (e.key === 'ArrowDown') { e.preventDefault(); setSelectedIndex(i => (i + 1) % suggestions.length); return; }
                    if (e.key === 'ArrowUp') { e.preventDefault(); setSelectedIndex(i => (i - 1 + suggestions.length) % suggestions.length); return; }
                    if (e.key === 'Enter' || e.key === 'Tab') { e.preventDefault(); applySuggestion(suggestions[selectedIndex]); return; }
                    if (e.key === 'Escape') { setSuggestions([]); return; }
                }

                if (e.key === 'Tab') {
                    e.preventDefault();
                    const newValue = value.substring(0, selectionStart) + "    " + value.substring(selectionEnd);
                    setCode(newValue);
                    setTimeout(() => { area.selectionStart = area.selectionEnd = selectionStart + 4; }, 0);
                }

                if (e.key === 'Enter') {
                    const lineStart = value.lastIndexOf('\n', selectionStart - 1) + 1;
                    const currentLine = value.substring(lineStart, selectionStart);
                    const indent = currentLine.match(/^\s*/)[0];
                    const charBefore = value[selectionStart - 1];
                    const charAfter = value[selectionStart];

                    if (charBefore === '>' && charAfter === '<' && value[selectionStart + 1] === '/') {
                        e.preventDefault();
                        const newText = `\n${indent}    \n${indent}`;
                        setCode(value.slice(0, selectionStart) + newText + value.slice(selectionStart));
                        setTimeout(() => { area.selectionStart = area.selectionEnd = selectionStart + indent.length + 5; }, 0);
                    } else {
                        e.preventDefault();
                        setCode(value.slice(0, selectionStart) + '\n' + indent + value.slice(selectionStart));
                        setTimeout(() => { area.selectionStart = area.selectionEnd = selectionStart + indent.length + 1; }, 0);
                    }
                }
            };

            const handleChange = (e) => {
                const val = e.target.value;
                const pos = e.target.selectionStart;
                const lastChar = val[pos - 1];
                const before = val.slice(0, pos);

                if (lastChar === '>') {
                    const tagMatch = before.match(/<([a-zA-Z0-9]+)$/);
                    if (tagMatch) {
                        const tag = tagMatch[1];
                        if (VOID_TAGS.includes(tag)) {
                            const updated = before.slice(0, -1) + " />" + val.slice(pos);
                            setCode(updated);
                            setTimeout(() => { e.target.selectionStart = e.target.selectionEnd = pos + 2; }, 0);
                        } else {
                            const updated = before + "</" + tag + ">" + val.slice(pos);
                            setCode(updated);
                            setTimeout(() => { e.target.selectionStart = e.target.selectionEnd = pos; }, 0);
                        }
                    } else { setCode(val); }
                } else { setCode(val); }

                const line = before.split('\n').pop();
                const tagTrigger = line.match(/<([a-zA-Z0-9]*)$/);
                const attrTrigger = line.match(/<[a-zA-Z0-9]+\s+([a-zA-Z]*)$/);
                const classTrigger = line.match(/class="([^"]*)$/);
                const idTrigger = line.match(/id="([^"]*)$/);

                if (tagTrigger) {
                    const filtered = HTML_TAGS.filter(t => t.startsWith(tagTrigger[1].toLowerCase()));
                    if (filtered.length) { updateSuggestUI(filtered.map(f => ({label: f, type: 'tag'})), pos); return; }
                }
                if (attrTrigger) {
                    const filtered = ATTRIBUTES.filter(a => a.startsWith(attrTrigger[1].toLowerCase()));
                    if (filtered.length) { updateSuggestUI(filtered.map(f => ({label: f, type: 'attr'})), pos); return; }
                }
                if (classTrigger) {
                    const filtered = memory.classes.filter(c => c.startsWith(classTrigger[1].toLowerCase()));
                    if (filtered.length) { updateSuggestUI(filtered.map(f => ({label: f, type: 'class'})), pos); return; }
                }
                if (idTrigger) {
                    const filtered = memory.ids.filter(i => i.startsWith(idTrigger[1].toLowerCase()));
                    if (filtered.length) { updateSuggestUI(filtered.map(f => ({label: f, type: 'id'})), pos); return; }
                }
                setSuggestions([]);
            };

            const updateSuggestUI = (list, pos) => {
                const lines = code.slice(0, pos).split('\n');
                setSuggestions(list);
                setSelectedIndex(0);
                setSuggestPos({ x: Math.min(lines[lines.length - 1].length * 9, 400), y: lines.length * 24 });
            };

            const applySuggestion = (s) => {
                const area = textareaRef.current;
                const pos = area.selectionStart;
                const before = code.slice(0, pos);
                const after = code.slice(pos);
                let newBefore;

                if (s.type === 'tag') newBefore = before.replace(/<[a-zA-Z0-9]*$/, `<${s.label}`);
                else if (s.type === 'attr') newBefore = before.replace(/\s+[a-zA-Z]*$/, ` ${s.label}=""`);
                else if (s.type === 'class' || s.type === 'id') newBefore = before.replace(/"[^"]*$/, `"${s.label}"`);

                setCode(newBefore + after);
                setSuggestions([]);
                setTimeout(() => { area.focus(); area.selectionStart = area.selectionEnd = newBefore.length - (s.type === 'attr' ? 1 : 0); }, 0);
            };

            return createElement('div', { className: 'glass rounded-3xl border border-white/10 overflow-hidden flex flex-col relative' },
                createElement('div', { className: 'bg-white/5 p-4 border-b border-white/10 flex justify-between items-center' },
                    createElement('div', { className: 'flex gap-1.5' },
                        createElement('div', { className: 'w-3 h-3 rounded-full bg-red-500/50' }),
                        createElement('div', { className: 'w-3 h-3 rounded-full bg-amber-500/50' }),
                        createElement('div', { className: 'w-3 h-3 rounded-full bg-green-500/50' })
                    ),
                    createElement('div', { className: 'flex gap-2' },
                        createElement('button', { onClick: () => onDeploy(code), className: 'accent-bg text-black px-4 py-1.5 rounded-lg text-[10px] font-black uppercase' }, 'Deploy'),
                        createElement('button', { onClick: () => {
                            const blob = new Blob([code], { type: 'text/html' });
                            window.open(URL.createObjectURL(blob), '_blank');
                        }, className: 'glass border border-white/10 px-4 py-1.5 rounded-lg text-[10px] font-black uppercase' }, 'New Tab')
                    )
                ),
                createElement('div', { className: 'relative' },
                    createElement('textarea', { ref: textareaRef, value: code, onChange: handleChange, onKeyDown: handleKeyDown, className: 'w-full h-[500px] smart-editor bg-transparent p-6 text-white text-sm overflow-auto whitespace-pre', spellCheck: false }),
                    suggestions.length > 0 && createElement('div', { className: 'suggestion-box glass border border-accent-color/30 rounded-xl overflow-hidden', style: { left: suggestPos.x + 20, top: suggestPos.y + 40 } },
                        suggestions.map((s, i) => createElement('div', { key: i, onClick: () => applySuggestion(s), className: `px-4 py-2 cursor-pointer text-xs font-bold flex justify-between ${i === selectedIndex ? 'active' : ''}` }, 
                            createElement('span', null, s.label),
                            createElement('span', { className: 'opacity-40 text-[8px]' }, s.type.toUpperCase())
                        ))
                    )
                )
            );
        };

        const SettingsModal = ({ onClose, currentTheme, onThemeChange, currentCloak, onCloakChange }) => (
            createElement('div', { className: 'fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/75 backdrop-blur-sm', onClick: onClose },
                createElement('div', { className: 'glass w-full max-w-md p-8 rounded-3xl modal-fade-in flex flex-col gap-6', onClick: e => e.stopPropagation() },
                    createElement('div', { className: 'flex justify-between items-center' },
                        createElement('h2', { className: 'text-2xl font-black italic tracking-tighter' }, 'SYSTEM CONFIG'),
                        createElement('button', { onClick: onClose, className: 'text-slate-500 hover:text-white' }, 'âœ•')
                    ),
                    createElement('div', { className: 'space-y-3' },
                        createElement('h3', { className: 'text-[10px] font-bold accent-text uppercase tracking-widest' }, 'Tab Cloaking'),
                        createElement('input', { type: 'text', value: currentCloak, onChange: (e) => onCloakChange(e.currentTarget.value), placeholder: 'Tab Title', className: 'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-accent-color transition-all' })
                    ),
                    createElement('div', { className: 'space-y-3' },
                        createElement('h3', { className: 'text-[10px] font-bold accent-text uppercase tracking-widest' }, 'Appearance'),
                        createElement('div', { className: 'grid grid-cols-2 gap-2' },
                            THEMES.map(theme => createElement('button', { key: theme.id, onClick: () => onThemeChange(theme.id), className: `p-3 rounded-lg border text-xs font-bold transition-all ${currentTheme === theme.id ? 'accent-bg text-black' : 'border-white/5 bg-white/5'}` }, theme.name))
                        )
                    ),
                    createElement('button', { onClick: onClose, className: 'accent-bg w-full py-3 rounded-xl font-black text-black text-sm uppercase' }, 'Done')
                )
            )
        );

        const GamePlayer = ({ zone, onClose, isAdminActive }) => {
            const [isLoading, setIsLoading] = useState(true);
            const [blobUrl, setBlobUrl] = useState('');
            const containerRef = useRef(null);

            useEffect(() => {
                if (zone.isLocal || zone.isIDE) { setBlobUrl(zone.url); setIsLoading(false); return; }
                fetch(zone.url.replace("{HTML_URL}", HTML_BASE)).then(r => r.text()).then(html => {
                    const blob = new Blob([html], { type: 'text/html' });
                    setBlobUrl(URL.createObjectURL(blob)); setIsLoading(false);
                });
            }, [zone.url]);

            const handleDownload = async () => {
                const response = await fetch(blobUrl);
                const text = await response.text();
                const blob = new Blob([text], { type: 'text/html' });
                const dUrl = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = dUrl;
                a.download = `${zone.name.replace(/\s+/g, '_')}.html`;
                a.click();
            };

            return createElement('div', { className: `fixed inset-0 z-[120] bg-black flex flex-col ${isAdminActive ? 'top-[42px]' : 'top-0'}` },
                createElement('header', { className: 'glass px-4 py-2 flex items-center justify-between border-b border-white/10' },
                    createElement('span', { className: 'accent-text font-black text-xs uppercase' }, zone.name),
                    createElement('div', { className: 'flex gap-2' },
                        createElement('button', { onClick: () => containerRef.current?.requestFullscreen(), className: 'px-3 py-1.5 glass rounded-lg text-[9px] font-bold uppercase hover:bg-white/10' }, 'Capture FS'),
                        createElement('button', { onClick: handleDownload, className: 'px-3 py-1.5 glass rounded-lg text-[9px] font-bold uppercase hover:bg-white/10' }, 'Capture Build'),
                        createElement('button', { onClick: onClose, className: 'px-3 py-1.5 bg-red-500/10 text-red-500 rounded-lg text-[10px] font-bold uppercase' }, 'Exit')
                    )
                ),
                createElement('div', { ref: containerRef, className: 'flex-1 relative bg-black' },
                    isLoading && createElement('div', { className: 'absolute inset-0 flex items-center justify-center' }, createElement('div', { className: 'w-8 h-8 border-4 border-accent-color/20 border-t-accent-color rounded-full animate-spin' })),
                    blobUrl && createElement('iframe', { src: blobUrl, className: 'w-full h-full border-none' })
                )
            );
        };

        const App = () => {
            const [zones, setZones] = useState([]);
            const [search, setSearch] = useState("");
            const [activeZone, setActiveZone] = useState(null);
            const [currentTheme, setCurrentTheme] = useState('dark');
            const [cloakTitle, setCloakTitle] = useState('Nexus');
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [activeTab, setActiveTab] = useState('games');
            const [scrollPerc, setScrollPerc] = useState(0);
            const fileRef = useRef(null);

            useEffect(() => { fetch(ZONES_URL).then(r => r.json()).then(setZones); }, []);
            useEffect(() => { document.title = cloakTitle || 'Nexus'; document.body.className = isAdminMode ? 'theme-admin-hellfire' : (THEMES.find(t => t.id === currentTheme)?.class || ''); }, [currentTheme, isAdminMode, cloakTitle]);

            const filteredAndGrouped = useMemo(() => {
                const results = zones.filter(z => z.name.toLowerCase().includes(search.toLowerCase()));
                const featured = results.filter(z => FEATURED_TITLES.includes(z.name));
                const hot = results.filter(z => HOT_TITLES.includes(z.name));
                const heroGame = featured.find(f => f.name === FEATURED_TITLES[0]) || featured[0];
                const restFeatured = featured.filter(f => f !== heroGame);
                const alpha = {};
                results.forEach(z => { let char = z.name[0].toUpperCase(); if (/[0-9]/.test(char)) char = '#'; if (!alpha[char]) alpha[char] = []; alpha[char].push(z); });
                return { heroGame, restFeatured, hot, alpha: Object.keys(alpha).sort().map(k => ({ char: k, games: alpha[k] })) };
            }, [zones, search]);

            return createElement('div', { className: 'min-h-screen flex flex-col' },
                createElement('div', { className: 'sidebar-trigger' }),
                createElement('aside', { className: 'sidebar flex flex-col p-6 gap-8' },
                    createElement('div', { className: 'flex items-center gap-3 mb-6' },
                        createElement('div', { className: 'w-10 h-10 accent-bg rounded-xl flex items-center justify-center text-black font-black text-xl accent-glow' }, 'N'),
                        createElement('span', { className: 'font-black italic text-xl tracking-tighter' }, 'NEXUS')
                    ),
                    createElement('nav', { className: 'flex-1 flex flex-col gap-3' },
                        createElement('button', { onClick: () => setActiveTab('games'), className: `sidebar-item ${activeTab === 'games' ? 'active' : ''}` }, createElement(GameIcon), 'Games'),
                        createElement('button', { onClick: () => setActiveTab('utilities'), className: `sidebar-item ${activeTab === 'utilities' ? 'active' : ''}` }, createElement(UtilityIcon), 'Utilities')
                    )
                ),

                createElement('header', { className: 'glass sticky top-0 z-[60] px-6 py-4 border-b border-white/5 flex items-center justify-between' },
                    createElement('div', { className: 'flex items-center gap-4' },
                        createElement('div', { className: 'relative w-12 h-12 flex items-center justify-center' },
                            createElement('div', { className: 'absolute inset-0 logo-ring rounded-full' }),
                            createElement('div', { className: 'accent-bg accent-glow w-6 h-6 rounded-lg flex items-center justify-center text-black font-black text-[10px] z-10' }, 'N')
                        ),
                        createElement('h1', { className: 'text-2xl font-black italic tracking-tighter text-white' }, 'Nexus')
                    ),
                    createElement('div', { className: 'flex items-center gap-3' },
                        createElement('input', { className: 'w-64 px-5 py-2.5 rounded-xl bg-white/5 border border-white/10 text-white text-sm', placeholder: 'Search...', value: search, onChange: e => setSearch(e.target.value) }),
                        createElement('button', { onClick: () => setIsSettingsOpen(true), className: 'p-2.5 glass rounded-xl hover:bg-white/10' }, 'âš™ï¸')
                    )
                ),

                createElement('main', { className: 'max-w-[90rem] mx-auto w-full py-12 px-6 space-y-24' },
                    activeTab === 'games' ? (
                        createElement(React.Fragment, null,
                            !search && createElement('section', { className: 'space-y-8' },
                                createElement('h2', { className: 'section-header text-xl font-black italic' }, 'Daily Spotlight'),
                                createElement('div', { className: 'grid grid-cols-1 md:grid-cols-12 gap-4' },
                                    createElement('div', { className: 'md:col-span-6' }, filteredAndGrouped.heroGame && createElement(GameCard, { variant: 'hero', zone: filteredAndGrouped.heroGame, onClick: () => setActiveZone(filteredAndGrouped.heroGame) })),
                                    createElement('div', { className: 'md:col-span-6 flex flex-col gap-4' }, filteredAndGrouped.restFeatured.slice(0, 2).map(g => createElement(GameCard, { key: g.id, variant: 'wide', zone: g, onClick: () => setActiveZone(g) }))),
                                    createElement('div', { className: 'md:col-span-12 grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4' }, filteredAndGrouped.restFeatured.slice(2, 8).map(g => createElement(GameCard, { key: g.id, zone: g, onClick: () => setActiveZone(g) })))
                                )
                            ),
                            createElement('section', { className: 'space-y-4' },
                                createElement('h2', { className: 'section-header text-xl font-black italic' }, 'Hot Right Now'),
                                createElement('div', { onScroll: e => setScrollPerc(e.currentTarget.scrollLeft / (e.currentTarget.scrollWidth - e.currentTarget.clientWidth)), className: 'flex gap-4 overflow-x-auto pb-4 visible-scroll snap-x' },
                                    filteredAndGrouped.hot.map(g => createElement('div', { key: g.id, className: 'snap-start' }, createElement(GameCard, { variant: 'carousel', zone: g, onClick: () => setActiveZone(g) })))
                                )
                            ),
                            createElement('section', { className: 'space-y-10' }, filteredAndGrouped.alpha.map(block => createElement('div', { key: block.char, className: 'vault-section' },
                                createElement('div', { className: 'letter-header' }, createElement('div', { className: 'letter-circle' }, block.char), createElement('div', { className: 'letter-line' })),
                                createElement('div', { className: 'vault-grid' }, block.games.map(g => createElement(GameCard, { key: g.id, variant: 'vault', zone: g, onClick: () => setActiveZone(g) })))
                            )))
                        )
                    ) : (
                        createElement('section', { className: 'space-y-12 max-w-5xl mx-auto' },
                            createElement('div', { className: 'text-center' },
                                createElement('h2', { className: 'text-3xl font-black italic tracking-tighter uppercase' }, 'Utilities Engine'),
                                createElement('p', { className: 'text-slate-500 mt-2 text-sm' }, 'Build, debug, and deploy local HTML assets instantly.')
                            ),
                            createElement(IDE, { onDeploy: (code) => setActiveZone({ name: 'IDE Preview', url: URL.createObjectURL(new Blob([code], {type: 'text/html'})), isIDE: true }) }),
                            createElement('div', { onClick: () => fileRef.current?.click(), className: 'glass p-12 rounded-3xl border-2 border-dashed border-white/10 flex flex-col items-center gap-4 cursor-pointer hover:border-accent-color' },
                                createElement('input', { type: 'file', ref: fileRef, accept: '.html', className: 'hidden', onChange: e => e.target.files[0] && setActiveZone({ name: e.target.files[0].name, url: URL.createObjectURL(e.target.files[0]), isLocal: true }) }),
                                createElement('div', { className: 'w-16 h-16 glass rounded-2xl flex items-center justify-center text-3xl' }, 'ðŸ“‚'),
                                createElement('p', { className: 'font-black uppercase text-xs' }, 'Upload Local HTML')
                            )
                        )
                    )
                ),

                activeZone && createElement(GamePlayer, { zone: activeZone, isAdminActive: isAdminMode, onClose: () => setActiveZone(null) }),
                isSettingsOpen && createElement(SettingsModal, { onClose: () => setIsSettingsOpen(false), currentTheme, onThemeChange: setCurrentTheme, currentCloak: cloakTitle, onCloakChange: setCloakTitle })
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(createElement(App));
    </script>
</body>
</html>